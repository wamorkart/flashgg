* H4Gamma

** Cloning the repository


   #+BEGIN_EXAMPLE
   export SCRAM_ARCH=slc7_amd64_gcc700
   cmsrel CMSSW_10_6_8
   cd CMSSW_10_6_8/src
   cmsenv
   git cms-init
   cd $CMSSW_BASE/src
   git clone -b h4g_fullrun2 git@github.com:wamorkart/flashgg.git
   source flashgg/setup_flashgg.sh
   #+END_EXAMPLE

   If everything now looks reasonable, you can build:
   #+BEGIN_EXAMPLE
   cd $CMSSW_BASE/src
   scram b -j 9
   #+END_EXAMPLE

** Setting up a voms Proxy

To access grid files to run the tagger on, you must run the following commands:

    #+BEGIN_EXAMPLE
    cmsenv
    voms-proxy-init --voms cms --valid 168:00
    #+END_EXAMPLE

after the voms command, you should receive an output similar to:

    #+BEGIN_EXAMPLE
    Created proxy in /tmp/x509up_u95168
    #+END_EXAMPLE

to set this proxy to your X509_USER_PROXY environment variable for the example above, simply use the command:

    #+BEGIN_EXAMPLE
    . proxy.sh x509up_u95168
    #+END_EXAMPLE

where x590up_u95168 would be replaced by whatever your proxy name is.


** H4G CandidateDumper to produce Vtx trainign ntuples

*** Running locally
    #+BEGIN_EXAMPLE
    cmsRun Taggers/test/H4GTest_cfg.py vtxBDTDumper=1 isCondor=0 year=2018 isSignal=1 mass=60 metaConditions=$CMSSW_BASE/src/flashgg/MetaData/data/MetaConditions/Era2018_RR-17Sep2018_v1.json doH4GVertex=1 doPdfWeights=0
    #+END_EXAMPLE

*** Running on condor
      #+BEGIN_EXAMPLE
      fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_VtxTrees.json -D -P -n 500 -d 2018_vtx -x cmsRun Taggers/test/H4GTest_cfg.py --no-copy-proxy  maxEvents=-1 -q workday --stage-to /eos/user/t/twamorka/h4g_fullRun2/2018_VtxTrees/
      #+END_EXAMPLE


** H4G Tagger

*** Running Locally

The H4G Tagger can be run locally on signal with:

    #+BEGIN_EXAMPLE
    cmsRun Systematics/test/workspaceStd.py metaConditions=MetaData/data/MetaConditions/Era2016_RR-17Jul2018_v1.json campaign=H4GandHH4G_2016_27Sep2019 dataset=SUSYGluGluToHToAA_AToGG_M-60_TuneCUETP8M1_13TeV_pythia8 doH4GTag=1 H4GTagsOnly=1 maxEvents=500 doSystematics=1 dumpWorkspace=0 dumpTrees=1  useAAA=1 useParentDataset=1 analysisType=lowMassAnalysis doPdfWeights=0
    #+END_EXAMPLE

and on data:
    #+BEGIN_EXAMPLE
    cmsRun Systematics/test/workspaceStd.py metaConditions=MetaData/data/MetaConditions/Era2016_RR-17Jul2018_v1.json campaign=Era2016_RR-17Jul2018_v2 dataset=/DoubleEG/spigazzi-Era2016_RR-17Jul2018_v2-legacyRun2FullV1-v0-Run2016H-17Jul2018-v1-86023db6be00ee64cd62a3172358fb9f/USER doH4GTag=1 H4GTagsOnly=1 maxEvents=500 doSystematics=1 dumpWorkspace=0 dumpTrees=1 useAAA=1 processId=Data processType=Data useParentDataset=1 analysisType=lowMassAnalysis doPdfWeights=0
    #+END_EXAMPLE

*** Running on condor with systematics
    #+BEGIN_EXAMPLE
    fggRunJobs.py --load Taggers/test/H4G_2016_Tagger/H4G_Signal_syst.json -D -P -n 100 -d Tagger_Signal_2016_wSyst -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/2016/
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Signal_syst.json -D -P -n 100 -d Tagger_Signal_2017_wSyst -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/2017/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Signal.json -D -P -n 100 -d Tagger_Signal_2018_wSyst -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/2018/
    #+END_EXAMPLE

*** Running on data condor with systematics
    #+BEGIN_EXAMPLE
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Data1.json -D -P -n 500 -d Tagger_Data1_2017 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/data_2017/
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Data2.json -D -P -n 500 -d Tagger_Data2_2017 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/data_2017/
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Data3.json -D -P -n 500 -d Tagger_Data3_2017 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/data_2017/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Data1.json -D -P -n 500 -d Tagger_Data1_2018 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/data_2018/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Data2.json -D -P -n 500 -d Tagger_Data2_2018 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/data_2018/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Data3.json -D -P -n 500 -d Tagger_Data3_2018 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/withSystematics/data_2018/
    #+END_EXAMPLE
*** Running on condor 2016

   Change the --stage-to option to the folder where you want the output root files to land

    #+BEGIN_EXAMPLE
    fggRunJobs.py --load Taggers/test/H4G_2016_Tagger/H4G_Signal1.json -D -P -n 500 -d Tagger_Signal1_2016 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2016/
    fggRunJobs.py --load Taggers/test/H4G_2016_Tagger/H4G_Signal2.json -D -P -n 500 -d Tagger_Signal2_2016 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2016/
    fggRunJobs.py --load Taggers/test/H4G_2016_Tagger/H4G_Signal3.json -D -P -n 500 -d Tagger_Signal3_2016 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2016/


    #+END_EXAMPLE

and on data:
    #+BEGIN_EXAMPLE
    fggRunJobs.py --load Taggers/test/H4G_2016_Tagger/H4G_Data1.json -D -P -n 500 -d Tagger_Data1_2016 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2016/
    fggRunJobs.py --load Taggers/test/H4G_2016_Tagger/H4G_Data2.json -D -P -n 500 -d Tagger_Data2_2016 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2016/
    fggRunJobs.py --load Taggers/test/H4G_2016_Tagger/H4G_Data3.json -D -P -n 500 -d Tagger_Data3_2016 -x cmsRun Systematics/test/workspaceStd.py -q workday --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2016/

    #+END_EXAMPLE

*** Running on condor 2017

    #+BEGIN_EXAMPLE
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Data1.json -D -P -n 500 -d Tagger_Data1_2017 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2017/
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Data2.json -D -P -n 500 -d Tagger_Data2_2017 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2017/
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Data3.json -D -P -n 500 -d Tagger_Data3_2017 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2017/

    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Signal1.json -D -P -n 50 -d Tagger_Signal1_2017 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2017/
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Signal2.json -D -P -n 500 -d Tagger_Signal2_2017 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2017/
    fggRunJobs.py --load Taggers/test/H4G_2017_Tagger/H4G_Signal3.json -D -P -n 500 -d Tagger_Signal3_2017 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2017/

    #+END_EXAMPLE

*** Running on condor 2018

    #+BEGIN_EXAMPLE
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Data1.json -D -P -n 500 -d Tagger_Data1_2018 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2018/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Data2.json -D -P -n 500 -d Tagger_Data2_2018 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2018/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Data3.json -D -P -n 500 -d Tagger_Data3_2018 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2018/

    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Signal1.json -D -P -n 500 -d Tagger_Signal1_2018 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2018/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Signal2.json -D -P -n 500 -d Tagger_Signal2_2018 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2018/
    fggRunJobs.py --load Taggers/test/H4G_2018_Tagger/H4G_Signal3.json -D -P -n 500 -d Tagger_Signal3_2018 -x cmsRun Systematics/test/workspaceStd.py -q tomorrow --no-copy-proxy analysisType=lowMassAnalysis maxEvents=-1 --stage-to /eos/user/t/twamorka/h4g_fullRun2/noSystematics/2018/

    #+END_EXAMPLE

*** Resubmitting missing jobs
    #+BEGIN_EXAMPLE
    python Systematics/scripts/resubmit_jobs.py -d <directory originally created by fggRunJobs> -s <directory where the jobs were staged to>
    #+END_EXAMPLE

*** 2016 H4G Tag ntuples
    #+BEGIN_EXAMPLE
    /eos/user/t/twamorka/26Jun2020_SignalTagger/hadd/
    #+END_EXAMPLE

** H4G Mixing
   #+BEGIN_EXAMPLE
   python H4GTreeMixing.py  -i /eos/user/t/twamorka/h4g_fullRun2/withSystematics/2016/hadd/data_2016.root -t 'tagsDumper/trees/Data_13TeV_H4GTag_0' -i1 1 -y 2016 -o test.root
   #+END_EXAMPLE
